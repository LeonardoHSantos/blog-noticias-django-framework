{% extends 'base.html' %}
{% load static %}
{% block title %} {{ post.title }} {% endblock %}
{% block content %}

    <div class="banner-adsense">
        <div class="adsense">

        </div>

    </div>

    <h1 class="principal-title" style="padding: 25px 0;">{{ post.title }}</h1>

    <div class="container-popup">
        {% include 'snippets/popups/login.html' %}
    </div>

    <div class="container-principal">

        <aside class="main-post">

            <div class="post-image">
                <img src="{{ post.cover_image.url }}" alt="{{ post.cover_image.url }}">
                <p class="font-image">Fonte: imagem criada com auxílio de IA, por Leonardo H Santos</p>
                <div class="post-actions">
                    <div class="action">
                        {% if post.post_like %}
                            <i class="fa-regular fa-heart like liked" data-action="{{ post.id }}" onclick="postLike(this);"></i>
                        {% else %}
                            <i class="fa-regular fa-heart like" data-action="{{ post.id }}" onclick="postLike(this);"></i>
                        {% endif %}
                    </div>
                    <div class="action">
                        <i class="fa-regular fa-comment comment developing"></i>
                    </div>
                    <div class="action">
                        <i class="fa-solid fa-share-nodes share" onclick="postShare(this);"></i>
                    </div>
                </div>
            </div>

            <div class="content">
                <p>{{ post.content|linebreaksbr }}</p>
            </div>
            <div class="info">
                <p>Visualizações:</p>
                <p>{{ post.number_of_visitors }}</p>
            </div>
            <div class="info">
                <p>Publicado em:</p>
                <p>{{ post.created_at }}</p>
            </div>
            <div class="info">
                <p>Autor:</p>
                <p>{{ post.author }}</p>
            </div>
            
            <div class="info">
                
                {% if user.is_authenticated %}
                    {% if user.id == post.user_id %}
                        <div class="post-tools-admin">
                            <ul>
                                <li><a href="{% url 'post_edit' post_id=post.id %}">editar</a></li>
                                <li><a href="{% url 'post_delete' post_id=post.id %}">excluir</a></li>
                            </ul>
                        </div>
                    {% endif %}
                {% endif %}
            </div>


        </aside>

        <div class="post-adsense">
            <div>
                <h3>publicidades</h3>
            </div>
            <div class="adsense"></div>
            <div class="adsense"></div>
            
        </div>

    </div>


<script>
    function postLike(e){
        const post_id = e.getAttribute("data-action");
        const urlPostLike = "{% url 'api_post_like' %}";
        const csrftoekn = "{{ csrf_token }}";
        const data = {"post_id": post_id};
        const headers = {
            "X-CSRFToken": csrftoekn
        }

        if (e.classList.contains("liked")){
            data.action = "dislike";
            
        } else {
            data.action = "liked";
        }

        fetch(urlPostLike, {
            method: "post",
            headers: headers,
            body: JSON.stringify(data)
        })
        .then((data)=>{
            return data.json();
        })
        .then((data)=>{
            if(data.code == 200){
                if(data.action == "liked"){
                    e.classList.add("liked");
                }
                else {
                    e.classList.remove("liked");
                }
            }
            else if(data.code == 404){
                popupShow();
            }
            else {
                console.log(data)
            }
        });
    }
</script>

<script>

    function postShare(e){
        if (navigator.share) {
            navigator = navigator.share.bind(navigator);
            navigator.share({
            title: 'Compartilhe meu artigo',
            text: 'Confira este artigo incrível!',
            url: window.location.href
            })
            .then(() => console.log('Conteúdo compartilhado com sucesso'))
            .catch((error) => console.error('Erro ao compartilhar:', error));
        } else {
            console.log('A API Navigator.share() não é suportada neste navegador.');
        }
    };
</script>


{% endblock %}